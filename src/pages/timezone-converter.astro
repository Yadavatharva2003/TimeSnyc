---
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import AdSlot from "../components/AdSlot.astro";
---

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Timezone Converter — TimeSnyc</title>

  <meta
    name="description"
    content="Convert time between time zones with date support and automatic DST handling."
  />

  <link rel="stylesheet" href="/styles/style.css" />
</head>

<body>
  <Header />

  <main class="container">

    <!-- TOP AD -->
    <div style="margin-bottom:24px">
      <AdSlot slot="1234567890" />
    </div>

    <!-- HERO -->
    <section class="hero">
      <h1>Timezone Converter</h1>
      <p>
        Convert time accurately across global time zones.
        Daylight Saving Time handled automatically.
      </p>
    </section>

    <!-- TOOL -->
    <section style="display:flex;justify-content:center;margin-top:32px">
      <div class="tool-box">

        <!-- FROM -->
        <div>
          <label class="muted">From timezone</label>
          <input
            id="from-search"
            class="input"
            placeholder="Search (India, London, UTC…)"
          />
          <select id="fromTz" class="select" style="margin-top:8px"></select>
        </div>

        <!-- SWAP -->
        <div style="display:flex;justify-content:center;margin:14px 0">
          <button id="swapBtn" class="button" style="width:auto">
            ⇄ Swap timezones
          </button>
        </div>

        <!-- TO -->
        <div>
          <label class="muted">To timezone</label>
          <input
            id="to-search"
            class="input"
            placeholder="Search (New York, Tokyo…)"
          />
          <select id="toTz" class="select" style="margin-top:8px"></select>
        </div>

        <!-- DATE -->
        <div class="field" style="margin-top:16px">
          <label style="min-width:90px">Date</label>
          <input type="date" class="input" id="dateInput" />
        </div>

        <!-- TIME -->
        <div class="field">
          <label style="min-width:90px">Time</label>
          <input type="time" class="input" id="timeInput" />
        </div>

        <!-- RESULT -->
        <div class="result" id="result">
          Converted time will appear here.
        </div>

        <!-- CTA -->
        <div
          style="
            margin-top:18px;
            padding:16px;
            border-radius:14px;
            background:linear-gradient(180deg,rgba(0,0,0,0.03),transparent);
          "
        >
          <strong>Planning a meeting?</strong>
          <p style="margin:6px 0 12px;color:var(--muted)">
            Find overlapping working hours across participants.
          </p>
          <a class="button" href="/meeting-planner">
            Open Meeting Planner →
          </a>
        </div>

      </div>
    </section>

    <!-- BOTTOM AD -->
    <div style="margin-top:36px">
      <AdSlot slot="0987654321" />
    </div>

  </main>

  <Footer />

  <!-- LOGIC -->
  <script type="module">
    import { populateTimezoneSelect } from "/scripts/timezones.js";

    const from = populateTimezoneSelect({
      selectId: "fromTz",
      searchId: "from-search",
    }) || {};

    const to = populateTimezoneSelect({
      selectId: "toTz",
      searchId: "to-search",
    }) || {};

    const dateInput = document.getElementById("dateInput");
    const timeInput = document.getElementById("timeInput");
    const result = document.getElementById("result");
    const swapBtn = document.getElementById("swapBtn");

    if (!from.select || !to.select) {
      result.textContent = "Timezone data failed to load.";
      throw new Error("Timezone select not initialized");
    }

    // Defaults
    const now = new Date();
    dateInput.valueAsDate = now;
    timeInput.value = now.toTimeString().slice(0, 5);

    from.select.value = "Asia/Kolkata";
    to.select.value = "Europe/London";

    function convert() {
      if (!dateInput.value || !timeInput.value) return;

      const [h, m] = timeInput.value.split(":").map(Number);
      const base = new Date(dateInput.value);
      base.setHours(h, m, 0, 0);

      try {
        const fromDate = new Date(
          base.toLocaleString("en-US", { timeZone: from.select.value })
        );
        const toDate = new Date(
          base.toLocaleString("en-US", { timeZone: to.select.value })
        );

        const dayDiff = toDate.getDate() - fromDate.getDate();

        result.innerHTML = `
          <div><strong>${from.select.value}</strong> → 
            ${fromDate.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit", hour12: false })}
          </div>
          <div style="margin-top:6px">
            <strong>${to.select.value}</strong> → 
            ${toDate.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit", hour12: false })}
            ${dayDiff === 1 ? " (Next day)" : dayDiff === -1 ? " (Previous day)" : ""}
          </div>
        `;
      } catch {
        result.textContent = "Invalid timezone selection.";
      }
    }

    swapBtn.onclick = () => {
      const a = from.select.value;
      from.select.value = to.select.value;
      to.select.value = a;
      convert();
    };

    from.select.onchange =
      to.select.onchange =
      dateInput.onchange =
      timeInput.onchange =
        convert;

    convert();
  </script>
</body>
</html>
